<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Flow - Kelompok 3</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-brown: #5d4037;
            --light-wood: #fdf5e6;
            --accent-green: #2ecc71;
            --danger-red: #ff4d4d;
            --warning-yellow: #f1c40f;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #e0d7c6; /* Background krem netral */
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        /* HEADER SECTION */
        .header-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 40px;
            background: var(--light-wood);
            border-bottom: 3px solid var(--primary-brown);
        }

        .brand h2 { margin: 0; color: var(--primary-brown); letter-spacing: 1px; }
        .points-badge { background: var(--primary-brown); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; margin-top: 5px; display: inline-block; }

        .level-card { width: 250px; text-align: right; }
        .progress-container { background: #ddd; border-radius: 10px; height: 12px; margin: 8px 0; overflow: hidden; }
        .progress-bar { width: 50%; background: #3498db; height: 100%; border-radius: 10px; }

        /* CONTENT SECTION */
        .main-content { padding: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }

        @media (max-width: 768px) {
            .main-content { grid-template-columns: 1fr; }
            .header-wrapper { flex-direction: column; text-align: center; }
            .level-card { text-align: center; margin-top: 20px; }
        }

        h3 { color: var(--primary-brown); margin-top: 0; }
        
        /* MOOD SELECTOR */
        .mood-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .mood-item { 
            border: 2px solid #eee; border-radius: 12px; padding: 15px; text-align: center; 
            cursor: pointer; transition: 0.3s; 
        }
        .mood-item:hover { border-color: var(--accent-green); background: #f0fff4; }
        input[type="radio"]:checked + .mood-box { border-color: var(--accent-green); background: #f0fff4; }

        textarea { width: 100%; border: 2px dashed #ccc; border-radius: 10px; padding: 15px; font-family: inherit; margin-bottom: 20px; box-sizing: border-box; }
        
        .btn-save { 
            width: 100%; background: var(--accent-green); color: white; border: none; 
            padding: 15px; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 1rem;
        }

        /* HISTORY SECTION */
        .history-list { max-height: 500px; overflow-y: auto; padding-right: 10px; }
        .history-card { 
            background: #f9f9f9; padding: 15px; border-radius: 12px; margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--primary-brown);
        }
        .history-info strong { font-size: 1.1rem; }
        .history-info small { color: #888; display: block; margin-top: 5px; }

        .action-btns { display: flex; gap: 5px; }
        .btn-del { background: var(--danger-red); color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
        .btn-edit { background: var(--warning-yellow); color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>

<div class="brand">
    <h2>MYMOOD JOURNAL üåø</h2>
    <div class="points-badge">üèÜ TOTAL: <%= totalPoints %> POINTS</div>
</div>
<div class="level-card">
    <strong>LEVEL SAAT INI:</strong>
    <div class="progress-container">
        <div class="progress-bar" style="width: <%= progress %>%;"></div>
    </div>
    <small><%= progress %>% Menuju Level Berikutnya</small>
</div>

    <div class="main-content">
        <div class="input-section">
            <h3>Bagaimana Perasaanmu?</h3>
            <form action="/simpan" method="POST">
                <div class="mood-grid">
                    <% ['Joy', 'Sad', 'Anger', 'Fear', 'Disgust', 'Excited'].forEach(m => { %>
                        <label>
                            <input type="radio" name="mood" value="<%= m %>" required style="display:none;">
                            <div class="mood-item">
                                <div style="font-size: 1.5rem;">
                                    <%= m=='Joy'?'üòä':m=='Sad'?'üò¢':m=='Anger'?'üò°':m=='Fear'?'üò®':m=='Disgust'?'ü§¢':'ü§©' %>
                                </div>
                                <span style="font-size: 0.8rem;"><%= m %></span>
                            </div>
                        </label>
                    <% }) %>
                </div>
                <textarea name="catatan" placeholder="Apa yang sedang kamu pikirkan?" rows="4" required></textarea>
                <button type="submit" class="btn-save">SIMPAN JURNAL</button>
            </form>
        </div>

        <div class="history-section">
            <h3>üìú Riwayat Terbaru</h3>
            <div class="history-list">
                <% if (typeof history !== 'undefined' && history.length > 0) { %>
                    <% history.forEach(function(item) { %>
                        <div class="history-card">
                            <div class="history-info">
                                <strong>
                                    <%= item.mood === 'Joy' ? 'üòä' : item.mood === 'Sad' ? 'üò¢' : item.mood === 'Anger' ? 'üò°' : item.mood === 'Fear' ? 'üò®' : item.mood === 'Disgust' ? 'ü§¢' : 'ü§©' %> 
                                    <%= item.mood %>
                                </strong>
                                <span>: <%= item.catatan %></span>
                                <small><%= new Date(item.tanggal).toLocaleString('id-ID') %></small>
                            </div>
                            <div class="action-btns">
                                <button onclick="editJurnal('<%= item.id %>', '<%= item.mood %>', '<%= item.catatan %>')" class="btn-edit">Edit</button>
                                <form action="/hapus/<%= item.id %>" method="POST" onsubmit="return confirm('Hapus jurnal ini?')">
                                    <button type="submit" class="btn-del">Hapus</button>
                                </form>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <p style="text-align: center; color: #888;">Belum ada catatan hari ini.</p>
                <% } %>
            </div>
        </div>
    </div>
</div>

<script>
    function editJurnal(id, oldMood, oldCatatan) {
        const newCatatan = prompt("Edit catatan kamu:", oldCatatan);
        if (newCatatan !== null) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/edit/' + id;
            
            const inputMood = document.createElement('input');
            inputMood.type = 'hidden'; inputMood.name = 'mood'; inputMood.value = oldMood;
            
            const inputCatatan = document.createElement('input');
            inputCatatan.type = 'hidden'; inputCatatan.name = 'catatan'; inputCatatan.value = newCatatan;

            form.appendChild(inputMood); form.appendChild(inputCatatan);
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>

</body>
</html>
